"" Ubuntu Raspberry Pi 4 VIMRC

" FUNCTIONS {{{
fun Indent()
  :normal! mpHmogg=G'ozt`p
endfun

fun GitBuf()
  :normal! gg0
endfun
fun GetCursor()
  if line("'\"") > 1 && line("'\"") <= line("$")
    exe "normal g'\""
  endif
endfun
" }}}

"" SETTINGS {{{
filetype indent plugin on
syntax on
set backspace=indent,eol,start
set guicursor=""
set background=dark

set tabstop=4
set shiftwidth=4
set softtabstop=4
set textwidth=0
set expandtab
set nowrap

set autochdir
set autoindent
set autoread
set copyindent
set cursorline
set cursorlineopt=number
set foldcolumn=0
set foldlevel=99
set foldlevelstart=99
set hidden
set nohlsearch
set ignorecase
set incsearch
set laststatus=2
set lazyredraw
set modeline
set noruler
set number
set path+=**
set relativenumber
set scrolloff=5
set shortmess+=acsoOTSF
set showcmd
set showmatch
set showmode
set signcolumn=yes
set smartcase
set smartindent
set statusline=
set statusline=(%n)\ %F\ %m%r%w%h%q%a\ %y\ \ \ col:\ %c\ \ %p%%%=[%c:%L]\ \ \ %p%%\ -\ %P\ \ \ |
set updatetime=250

set wildmode=list:longest,full
set completeopt=menuone,popup

set noundofile
set nobackup
set noswapfile

let mapleader=" "
let maplocalleader="\\"
"" }}}

"" PLUGINS {{{
"" YCM {{{
let g:ycm_min_num_of_chars_for_completion = 3
let g:ycm_min_num_identifier_candidate_chars = 0
let g:ycm_max_num_candidates = 50
" let g:ycm_max_num_candidates_to_detail = 0
let g:ycm_max_num_identifier_candidates = 10
let g:ycm_auto_trigger = 1
let g:ycm_filetype_blacklist = {
      \ 'tagbar': 1,
      \ 'notes': 1,
      \ 'markdown': 1,
      \ 'netrw': 1,
      \ 'unite': 1,
      \ 'text': 1,
      \ 'vimwiki': 1,
      \ 'pandoc': 1,
      \ 'infolog': 1,
      \ 'leaderf': 1,
      \ 'mail': 1
      \}
let g:ycm_filetype_specific_completion_to_disable = {
      \ 'gitcommit': 1
      \}
let g:ycm_show_diagnostics_ui = 1
let g:ycm_error_symbol = '>>'
let g:ycm_warning_symbol = '--'
let g:ycm_enable_diagnostic_signs = 1
let g:ycm_enable_diagnostic_highlighting = 1
let g:ycm_echo_current_diagnostic = 1

"" See, :help location-list
let g:ycm_always_populate_location_list = 0

"" Try set to 0 for no-extra window
let g:ycm_open_loclist_on_ycm_diags = 1
let g:ycm_seed_identifiers_with_syntax = 0

"" set 0 for no previews or popups. preview
"" or popup must be set in completeopt
let g:ycm_add_preview_to_completeopt = 1

"" Defaults for completion/insertion = 0
let g:ycm_autoclose_preview_window_after_completion = 1
let g:ycm_autoclose_preview_window_after_insertion = 1

"" Some like adding 'enter' the list
let g:ycm_key_list_select_completion = ['<TAB>', '<Down>']
let g:ycm_key_list_previous_completion = ['<S-TAB>', '<Up>']

"" Closes popup if it's blocking view
let g:ycm_key_list_stop_completion = ['<C-y>']

"" try enter
let g:ycm_key_invoke_completion = '<C-Space>'
let g:ycm_key_detailed_diagnostics = '<leader>d'

let g:ycm_use_clangd = 1
" let g:ycm_clangd_binary_path = ''

"" Set to 0 if seeing the new diags is not wanted
let g:ycm_update_diagnostics_in_insert_mode = 1
"" }}}

"" ALE {{{
let g:ale_enabled = 1
let g:airline#extensions#ale#enabled = 0
set omnifunc=ale#completion#OmniFunc
let g:ale_set_signs = 1
let g:ale_max_signs = 100
" let g:ale_close_preview_on_insert = 1
let g:ale_completion_enabled = 1
let g:ale_disable_lsp = 0
let g:ale_lsp_suggestions = 1
let g:ale_use_neovim_diagnostics_api = 0
let g:ale_set_highlights = 0
" let g:ale_exclude_highlights = ['.*', '\w*', '\d*', 'local variable']
let g:ale_virtualtext_cursor = 'disabled' " 'current'
let g:ale_sign_column_always = 1

let g:ale_popup_menu_enabled = 0
let g:ale_detail_to_floating_preview = 1
let g:ale_cursor_detail = 1 " popup balloon
let g:ale_floating_window_border = ['│', '─', '╭', '╮', '╯', '╰', '│', '─']
let g:ale_hover_cursor = 0

let g:ale_echo_cursor = 0
let g:ale_set_highlights = 0
let g:ale_sign_error = '>>'
let g:ale_sign_warning = '--'
let g:ale_echo_msg_error_str = 'E'
let g:ale_echo_msg_warning_str = 'W'
let g:ale_echo_msg_info_str = 'I'
let g:ale_echo_msg_format = ' [%linter%] %code% - %s'
let g:ale_loclist_msg_format = '[%linter%] %code% - %s'
" let g:ale_lsp_show_message_format = ''

let g:ale_fix_on_save = 1
let g:ale_lint_on_insert_leave = 1
let g:ale_lint_on_enter = 0
let g:ale_lint_on_save = 1
let g:ale_lint_on_text_changed = 'normal'
let g:ale_linters_explicit = 1

let g:ale_set_loclist = 0
let g:ale_set_quickfix = 1
let g:ale_open_list = 0
let g:ale_keep_list_window_open = 0

highlight clear ALEErrorSign
highlight clear ALEWarningSign
""}}}

"" VIM-PLUG {{{
call plug#begin()
Plug 'morhetz/gruvbox'
Plug 'tpope/vim-fugitive'
Plug 'scrooloose/nerdtree'
Plug 'airblade/vim-gitgutter'
Plug 'mattn/emmet-vim'
Plug 'easymotion/vim-easymotion'
Plug 'christoomey/vim-tmux-navigator'
Plug 'mbbill/undotree'
Plug 'dense-analysis/ale'
Plug 'nvie/vim-flake8'
" Plug 'itchyny/lightline.vim'
" Plug 'msanders/snipmate.vim'
" Plug 'honza/vim-snippets'
" Plug 'SirVer/ultisnips'
Plug 'valloric/youcompleteme'
call plug#end()

colorscheme retrobox
"" }}}

"" ALE {{{
" 'rust': ['analyzer', 'rustc', 'cargo'],
let g:ale_linters = {
      \ 'python': ['flake8'],
      \ 'rust': ['analyzer'],
      \ 'vim': ['vimls', 'vint'],
      \ 'cpp': ['clangd', 'cpplint'],
      \ 'json': ['eslint'],
      \ }
let g:ale_fixers = {
      \ '*': ['remove_trailing_lines', 'trim_whitespace'],
      \ 'python': ['black', 'isort'],
      \ 'rust': ['rustfmt'],
      \ 'cpp': ['clang-format'],
      \ 'json': ['prettier'],
      \}
""}}}

"" NERDTREE {{{
let g:NERDTreeDirArrowExpandable = '▸'
let g:NERDTreeDirArrowCollapsible = '▾'
let g:NERDTreeQuitOnOpen = 1
let g:NERDTreeShowHidden = 1
nnoremap <leader>o :NERDTreeFocus<CR>
" nnoremap <leader>o :NERDTree<CR>
nnoremap <leader>nf :NERDTreeFind<CR>
""}}}

" FUGITIVE {{{
nnoremap <leader>ga :Git add .<cr>
nnoremap <leader>gc :Git commit<cr>
" }}}

"" EMMET {{{
let g:user_emmet_mode='inv'
let g:user_emmet_leader_key=','
""}}}

"" LIGHTLINE {{{
"" laststatus equals 2, noshowmode must be set
"" powerline, wombat, solarized, PaperColor, one
"" LIGHTLINE ADVANCED
"" See Vim-Awesome
" let g:lightline = {'colorscheme': 'one',}
"" }}}

"" EASYMOTION {{{
" <Leader>f{char} to move to {char}
map ,f <Plug>(easymotion-bd-f)
nmap ,f <Plug>(easymotion-overwin-f)
nmap ,s <Plug>(easymotion-overwin-f2)
map ,L <Plug>(easymotion-bd-jk)
nmap ,L <Plug>(easymotion-overwin-line)
map ,w <Plug>(easymotion-bd-w)
nmap ,w <Plug>(easymotion-overwin-w)
""}}}

"" UNDOTREE {{{
nnoremap <leader>ut :UndotreeToggle<cr>
"" }}}

"" FLAKE8 {{{
""}}}
"" END PLUGINS }}}

"" MAPPINGS {{{
inoremap kj <ESC>
vnoremap kj <ESC>

"" ALE
nnoremap <leader>alf :ALEFix<CR>
nnoremap <leader>alo :lopen<CR>
nnoremap <leader>alc :copen<CR>
nnoremap <leader>all :ALELint<CR>
nnoremap <leader>alt :ALEToggle<CR>
nnoremap <leader>ali :ALEInfo<CR>

nnoremap <silent> <leader>w :write<cr>
nnoremap <silent> <leader>q ZQ
nnoremap <silent> <leader>z ZZ
nnoremap <silent> <localleader>e :edit $MYVIMRC<cr>
nnoremap <silent> <localleader>ve :vsplit<cr><C-w>l:edit $MYVIMRC<cr>
nnoremap <localleader>s :write<cr>:source $MYVIMRC<cr>
nnoremap <leader>t :write<CR>:shell<CR>

nnoremap <leader>p "+p
nnoremap w W
nnoremap ,a zt
nnoremap ,b zb
nnoremap ,z zz
nnoremap <S-b> _
nnoremap <S-e> $
nnoremap <S-y> y$
nnoremap n nzz
nnoremap N Nzz
nnoremap ' `
nnoremap '' ``
nnoremap <F8> @
nnoremap <F9> @@
vnoremap J :m '>+1<CR>gv=gv
vnoremap K :m '<-2<CR>gv=gv
vnoremap < <gv
vnoremap > >gv
nnoremap <leader>bn :bnext<cr>
nnoremap <leader>bp :bprevious<cr>
nnoremap <leader>* :%s/\<<C-r><C-w>\>//gI<left><left><left>
nnoremap <leader>& :%s/\<<C-r><C-w>\>//gIc<left><left><left><left>

nnoremap <localleader>sh gg/<<<<<<<<CR>dd/=======<CR>V/>>>>>>><CR>d<ESC>
nnoremap <localleader>sr gg/<<<<<<<<CR>V/=======<CR>d/>>>>>>><CR>dd<ESC>
nnoremap <localleader>sb gg/<<<<<<<<CR>dd/=======<CR>dd/>>>>>>><CR>dd<ESC>
nnoremap <localleader>sn /<<<<<<<<CR>

nnoremap ,w( :normal! ebi(<esc>ea)<esc>
nnoremap ,w[ :normal! ebi[<esc>ea]<esc>
nnoremap ,w{ :normal! ebi{<esc>ea}<esc>
nnoremap ,w< :normal! ebi<<esc>ea><esc>

nnoremap <silent> <leader>v :vsplit<cr><C-w>l
nnoremap <silent> <leader>s :split<cr><C-w>j
nnoremap <silent> <C-h> <C-w>h
nnoremap <silent> <C-j> <C-w>j
nnoremap <silent> <C-k> <C-w>k
nnoremap <silent> <C-l> <C-w>l
nnoremap <leader>hh :vertical resize+1<CR>
nnoremap <leader>ll :vertical resize-1<CR>
nnoremap <leader>jj :resize+1<CR>
nnoremap <leader>kk :resize-1<CR>
nnoremap <leader>rs <C-w>=

nnoremap <leader>x <Plug>(ale_hover)

" nnoremap <leader>x :<c-u>execute normal! mpgg02WdwiHELLO \<lt>esc>'p<cr>
"" }}}

"" AUTOGROUP AUGROUP {{{
augroup ALL " {{{
  autocmd!
  autocmd BufReadPost * call GetCursor()
  autocmd BufReadPost * if line("'\"") > 1 && line("'\"") <= line("$")
        \ | exe "normal g'\"" | endif
  autocmd BufWritePre * %s/\s\+$//e
  autocmd BufWritePre * call Indent()
augroup END " }}}

augroup VIM " {{{
  autocmd!
  autocmd FileType vim setlocal ts=2 sw=2 sts=2 fdc=3 fdm=marker
augroup END " }}}

augroup PYTHON " {{{
  autocmd!
  autocmd FileType python setlocal cc=80,100 fdm=indent fdc=4
  autocmd BufEnter *.py nnoremap <F5> :write<cr>:!python3 %<CR>
  autocmd BufEnter *.py nnoremap <F6> :!black %<CR>
  autocmd BufEnter *.py nnoremap <F7> call flake8#Flake8()<CR>
augroup END " }}}

augroup C " {{{
  autocmd!
  autocmd FileType c,cpp silent setlocal ts=8 sw=8 sts=8 et nowrap noai nosi
        \ noci cin cino=ln,c2 fdc=4 fdm=indent cc=80
  autocmd BufEnter *.c nnoremap <buffer> <leader>b o{<cr>}<esc>ko
  autocmd BufEnter *.c nnoremap <buffer> <F5> :!./main<cr>
  autocmd BufEnter *.c nnoremap <buffer> <leader>mm :write<cr>:!make main<cr>
augroup END " }}}

augroup RUST " {{{
  autocmd!
  autocmd FileType rust silent setlocal ts=4 sw=4 sts=4 et nowrap noai nosi
        \ noci cin cino=ln,c2 fdc=3 fdm=indent cc=80
  autocmd BufEnter *.rs nnoremap <buffer> <leader>b A<space>{<cr>}<esc>ko
  autocmd BufEnter *.rs nnoremap <buffer> <F5> :!cargo run<cr>
  autocmd BufEnter *.rs nnoremap <buffer> <leader>mm :write<cr>:!cargo build<cr>
augroup END " }}}

augroup BASH " {{{
  autocmd!
  autocmd FileType sh silent setlocal ts=4 sts=4 sw=4 cc=80 fdc=0
augroup END " }}}

augroup TEXT " {{{
  autocmd!
  autocmd FileType text silent setlocal noet wrap cc=80
augroup END " }}}

augroup PLAINTEX " {{{
  au!
  au FileType plaintex silent setlocal cc=80
augroup END " }}}

augroup NERDTREE " {{{
  autocmd!
  autocmd StdinReadPre * let s:std_in=1
  autocmd VimEnter * if argc() == 0 && !exists('s:std_in') | NERDTree | endif
  autocmd BufEnter * if tabpagenr('$') == 1
        \ && winnr('$') == 1
        \ && exists('b:NERDTree') && b:NERDTree.isTabTree() | quit | endif
  autocmd BufEnter * if winnr('$') == 1 && exists('b:NERDTree')
        \ && b:NERDTree.isTabTree() | quit | endif
  autocmd BufEnter * if bufname('#') =~ 'NERD_tree_\d\+'
        \ && bufname('%') !~ 'NERD_tree_\d\+'
        \ && winnr('$') > 1 | let buf=bufnr() | buffer#
        \ | execute =======>\"normal! \<C-W>w" | execute 'buffer'.buf | endif
augroup END " }}}

augroup GITCOMMIT " {{{
  autocmd!
  autocmd FileType gitcommit setlocal tw=50 cc=50
  autocmd FileType gitcommit call GitBuf()
augroup END " }}}

augroup MyYCMCustom " {{{
  autocmd!
  autocmd FileType c,cpp let b:ycm_hover = {
        \ 'command': 'GetDoc',
        \ 'syntax': &filetype
        \ }
augroup END " }}}

augroup SKELETON " {{{
  autocmd!
  autocmd BufNewFile *.py 0r ~/.vim/skeleton/skeleton.py
  autocmd BufNewFile *.c 0r ~/.vim/skeleton/skeleton.c
  autocmd BufNewFile *.sh 0r ~/.vim/skeleton/skeleton.sh
augroup END " }}}

augroup BOTTOM " {{{
  autocmd!
  autocmd FileType arduino,python,c,cpp,sh,vim,rust
        \ :onoremap ib :<C-u>normal! 0f[vi[<CR>
  autocmd FileType arduino,python,c,cpp,sh,vim,rust
        \ :onoremap it :<C-u>normal! 0f<vi<<CR>
  autocmd FileType arduino,python,c,cpp,sh,vim,rust
        \ :onoremap ir :<C-u>normal! 0f{vi{<CR>
  autocmd FileType arduino,python,c,cpp,sh,vim,rust
        \ :onoremap ip :<C-u>normal! 0f(vi(<CR>
augroup END " }}}
"" }}}
